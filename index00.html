<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>在线M3U ↔ TXT 双向转换工具</title>
  <meta name="description" content="支持M3U转TXT和TXT转M3U双向转换，纯前端处理，安全不上传，支持分组、频道名处理。">
  <meta name="keywords" content="m3u转txt,txt转m3u,双向转换,iptv播放列表,在线工具">
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f9f9f9;
      color: #333;
      text-align: center;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
    }
    .mode-buttons {
      margin: 20px 0;
    }
    .mode-buttons button {
      padding: 12px 24px;
      margin: 0 15px;
      font-size: 18px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .mode-buttons button.active {
      background-color: #e74c3c;
    }
    .mode-buttons button:hover {
      background-color: #2980b9;
    }
    h3 {
      color: #34495e;
      margin-top: 30px;
    }
    textarea {
      width: 100%;
      height: 350px;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-family: monospace;
      font-size: 14px;
      box-sizing: border-box;
      margin-top: 8px;
    }
    textarea[readonly] {
      background-color: #fff;
    }
    .buttons {
      margin: 25px 0;
    }
    .buttons button {
      padding: 10px 20px;
      margin: 0 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 15px;
    }
    .buttons button:hover {
      background-color: #45a049;
    }
    hr {
      border: 0;
      border-top: 1px solid #eee;
      margin: 40px 0;
    }
    footer {
      margin-top: 50px;
      color: #777;
      font-size: 14px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>在线M3U ↔ TXT 双向转换工具</h1>
  <p>纯前端处理 · 安全不上传 · 支持分组与频道名智能处理</p>

  <div class="mode-buttons">
    <button id="modeM3UtoTXT" class="active" onclick="switchMode('m3u2txt')">M3U → TXT 转换</button>
    <button id="modeTXTtoM3U" onclick="switchMode('txt2m3u')">TXT → M3U 转换</button>
  </div>

  <hr>

  <!-- M3U → TXT 模式 -->
  <div id="m3u2txt-section">
    <h3>请粘贴M3U格式源：</h3>
    <textarea id="m3u-input" placeholder="粘贴完整的M3U播放列表内容（支持 #EXTINF、group-title 等）"></textarea>

    <div class="buttons">
      <button onclick="convertM3UtoTXT()">转换格式</button>
      <button onclick="clearAll()">清除屏幕</button>
      <button onclick="copyTXT()">拷贝结果</button>
      <button onclick="saveAsTXT()">保存为TXT</button>
    </div>

    <h3>TXT格式转换结果：</h3>
    <textarea id="txt-output" readonly placeholder="转换后的TXT内容将显示在这里（分组,#genre# + 频道名,URL）"></textarea>
  </div>

  <!-- TXT → M3U 模式 -->
  <div id="txt2m3u-section" class="hidden">
    <h3>请粘贴TXT格式源：</h3>
    <textarea id="txt-input" placeholder="每行格式：频道名称,URL&#10;或：分组名称,#genre#"></textarea>

    <div class="buttons">
      <button onclick="convertTXTtoM3U()">转换格式</button>
      <button onclick="clearAll()">清除屏幕</button>
      <button onclick="copyM3U()">拷贝结果</button>
      <button onclick="saveAsM3U()">保存为M3U</button>
    </div>

    <h3>M3U格式转换结果：</h3>
    <textarea id="m3u-output" readonly placeholder="转换后的M3U播放列表将显示在这里"></textarea>
  </div>

  <footer>
    <p>© 2026 All Rights Reserved. 基于 SteveDarnell 与社区开源逻辑优化</p>
  </footer>

  <script>
    // 切换模式
    function switchMode(mode) {
      if (mode === 'm3u2txt') {
        document.getElementById('m3u2txt-section').style.display = 'block';
        document.getElementById('txt2m3u-section').style.display = 'none';
        document.getElementById('modeM3UtoTXT').classList.add('active');
        document.getElementById('modeTXTtoM3U').classList.remove('active');
      } else {
        document.getElementById('m3u2txt-section').style.display = 'none';
        document.getElementById('txt2m3u-section').style.display = 'block';
        document.getElementById('modeM3UtoTXT').classList.remove('active');
        document.getElementById('modeTXTtoM3U').classList.add('active');
      }
    }

    // 清屏通用
    function clearAll() {
      document.getElementById('m3u-input').value = '';
      document.getElementById('txt-output').value = '';
      document.getElementById('txt-input').value = '';
      document.getElementById('m3u-output').value = '';
    }

    // ====================== M3U → TXT ======================
    function convertM3UtoTXT() {
      const input = document.getElementById('m3u-input').value.trim();
      if (!input) {
        alert('请输入M3U内容');
        return;
      }

      const lines = input.split('\n');
      let result = [];
      let currentGroup = null;

      for (let i = 0; i < lines.length; i++) {
        let line = lines[i].trim();

        if (line.startsWith('#EXTM3U')) continue;

        if (line.startsWith('#EXTINF:')) {
          // 提取 group-title
          let group = '未分组';
          const groupMatch = line.match(/group-title="([^"]*)"/);
          if (groupMatch && groupMatch[1].trim() !== '') {
            group = groupMatch[1].trim();
          }

          // 分组切换时插入 genre 行
          if (currentGroup !== group) {
            currentGroup = group;
            result.push(currentGroup + ',#genre#');
          }

          // 提取频道名称（最后一个逗号后）
          const parts = line.split(',');
          const name = parts[parts.length - 1].trim();

          // 找下一行 URL
          let url = '';
          for (let j = i + 1; j < lines.length; j++) {
            let nextLine = lines[j].trim();
            if (nextLine && !nextLine.startsWith('#')) {
              url = nextLine;
              i = j;
              break;
            }
          }

          if (name && url) {
            result.push(name + ',' + url);
          }
        }
      }

      document.getElementById('txt-output').value = result.join('\n');
    }

    function copyTXT() {
      const output = document.getElementById('txt-output');
      if (!output.value) { alert('没有可拷贝的内容'); return; }
      output.select();
      document.execCommand('copy');
      alert('TXT结果已拷贝到剪贴板！');
    }

    function saveAsTXT() {
      const content = document.getElementById('txt-output').value;
      if (!content) { alert('没有可保存的内容'); return; }
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'playlist.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    // ====================== TXT → M3U ======================
    function convertTXTtoM3U() {
      const txtInput = document.getElementById('txt-input').value;
      if (!txtInput.trim()) {
        alert('请输入TXT内容');
        return;
      }

      const lines = txtInput.split('\n');
      let m3uOutput = '#EXTM3U x-tvg-url="https://live.fanmingming.com/e.xml"\n';
      let currentGroup = null;

      for (const line of lines) {
        const trimmedLine = line.trim();
        if (trimmedLine === '') continue;

        if (trimmedLine.includes('#genre#')) {
          currentGroup = trimmedLine.replace(/,#genre#/, '').trim();
        } else {
          const [originalChannelName, channelLink] = trimmedLine.split(',').map(item => item.trim());
          if (!channelLink) continue;

          // 处理频道名：CCTV-8+ → CCTV8，保留数字
          const processedChannelName = originalChannelName.replace(/(CCTV|CETV)-(\d+).*/, '$1$2');

          m3uOutput += `#EXTINF:-1 tvg-name="${processedChannelName}" tvg-logo="https://live.fanmingming.com/tv/${processedChannelName}.png"`;
          if (currentGroup) {
            m3uOutput += ` group-title="${currentGroup}"`;
          }
          m3uOutput += `,${originalChannelName}\n${channelLink}\n`;
        }
      }

      document.getElementById('m3u-output').value = m3uOutput;
    }

    function copyM3U() {
      const output = document.getElementById('m3u-output');
      if (!output.value) { alert('没有可拷贝的内容'); return; }
      output.select();
      document.execCommand('copy');
      alert('M3U结果已拷贝到剪贴板！');
    }

    function saveAsM3U() {
      const content = document.getElementById('m3u-output').value;
      if (!content) { alert('没有可保存的内容'); return; }
      const blob = new Blob([content], { type: 'audio/x-mpegurl;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'playlist.m3u';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
