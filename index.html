<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>在线M3U ↔ TXT 双向转换工具</title>
  <meta name="description" content="支持M3U转TXT和TXT转M3U双向转换，纯前端处理，安全不上传，支持分组、频道名处理。">
  <meta name="keywords" content="m3u转txt,txt转m3u,双向转换,iptv播放列表,在线工具">
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
    }
    .container {
      background: rgba(255, 255, 255, 0.96);
      border-radius: 18px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }
    /* 导航栏 */
    nav {
      background: linear-gradient(120deg, #4facfe 0%, #00f2fe 100%);
      padding: 18px 0;
      text-align: center;
    }
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    nav li {
      display: inline-block;
    }
    nav a {
      display: block;
      padding: 14px 28px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      text-decoration: none;
      font-size: 17px;
      font-weight: 600;
      border-radius: 30px;
      transition: all 0.3s;
      backdrop-filter: blur(5px);
    }
    nav a:hover {
      background: rgba(255, 255, 255, 0.4);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }
    nav a.active {
      background: #e74c3c;
      box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
    }

    .main-content {
      padding: 30px 40px;
      text-align: center;
    }
    h1 {
      color: #2c3e50;
      margin: 0 0 10px;
      font-size: 32px;
    }
    .subtitle {
      color: #555;
      margin-bottom: 30px;
      font-size: 18px;
    }

    .mode-buttons {
      margin: 30px 0;
    }
    .mode-buttons button {
      padding: 14px 30px;
      margin: 0 15px;
      font-size: 18px;
      background: linear-gradient(120deg, #3498db 0%, #2980b9 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 6px 15px rgba(52, 152, 219, 0.3);
    }
    .mode-buttons button.active {
      background: linear-gradient(120deg, #e74c3c 0%, #c0392b 100%);
      transform: scale(1.05);
    }
    .mode-buttons button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(52, 152, 219, 0.4);
    }

    h3 {
      color: #34495e;
      margin-top: 35px;
      font-size: 20px;
    }
    textarea {
      width: 100%;
      height: 380px;
      padding: 16px;
      border: 2px solid #ddd;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      font-size: 15px;
      box-sizing: border-box;
      margin-top: 10px;
      transition: border-color 0.3s;
    }
    textarea:focus {
      border-color: #4facfe;
      outline: none;
      box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.2);
    }
    textarea[readonly] {
      background-color: #f8f9ff;
    }

    .buttons {
      margin: 30px 0;
    }
    .buttons button {
      padding: 12px 24px;
      margin: 8px 10px;
      background: linear-gradient(120deg, #4CAF50 0%, #45a049 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 6px 15px rgba(76, 175, 80, 0.3);
    }
    .buttons button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(76, 175, 80, 0.4);
    }

    hr {
      border: 0;
      height: 1px;
      background: linear-gradient(to right, transparent, #ddd, transparent);
      margin: 50px 0;
    }

    footer {
      text-align: center;
      padding: 30px;
      background: #f0f4f8;
      color: #718096;
      font-size: 14px;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 768px) {
      nav a {
        padding: 12px 20px;
        font-size: 15px;
      }
      .mode-buttons button {
        display: block;
        width: 80%;
        margin: 15px auto;
      }
      .main-content {
        padding: 20px;
      }
      textarea {
        height: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 导航栏 -->
    <nav>
      <ul>
        <li><a href="#" class="active">M3U ↔ TXT 转换</a></li>
        <li><a href="editor.html">文字处理</a></li>
        <li><a href="szq.html">石子棋</a></li>
        <li><a href="pool.html">桌球</a></li>
        </ul>
    </nav>

    <div class="main-content">
      <h1>在线M3U ↔ TXT 双向转换工具</h1>
      <p class="subtitle">纯前端处理 · 安全不上传 · 支持分组与频道名智能处理</p>

      <div class="mode-buttons">
        <button id="modeM3UtoTXT" class="active" onclick="switchMode('m3u2txt')">M3U → TXT 转换</button>
        <button id="modeTXTtoM3U" onclick="switchMode('txt2m3u')">TXT → M3U 转换</button>
      </div>

      <hr>

      <!-- M3U → TXT 模式 -->
      <div id="m3u2txt-section">
        <h3>请粘贴M3U格式源：</h3>
        <textarea id="m3u-input" placeholder="粘贴完整的M3U播放列表内容（支持 #EXTINF、group-title 等）"></textarea>

        <div class="buttons">
          <button onclick="convertM3UtoTXT()">转换格式</button>
          <button onclick="clearAll()">清除屏幕</button>
          <button onclick="copyTXT()">拷贝结果</button>
          <button onclick="saveAsTXT()">保存为TXT</button>
        </div>

        <h3>TXT格式转换结果：</h3>
        <textarea id="txt-output" readonly placeholder="转换后的TXT内容将显示在这里（分组,#genre# + 频道名,URL）"></textarea>
      </div>

      <!-- TXT → M3U 模式 -->
      <div id="txt2m3u-section" class="hidden">
        <h3>请粘贴TXT格式源：</h3>
        <textarea id="txt-input" placeholder="每行格式：频道名称,URL&#10;或：分组名称,#genre#"></textarea>

        <div class="buttons">
          <button onclick="convertTXTtoM3U()">转换格式</button>
          <button onclick="clearAll()">清除屏幕</button>
          <button onclick="copyM3U()">拷贝结果</button>
          <button onclick="saveAsM3U()">保存为M3U</button>
        </div>

        <h3>M3U格式转换结果：</h3>
        <textarea id="m3u-output" readonly placeholder="转换后的M3U播放列表将显示在这里"></textarea>
      </div>
    </div>

    <footer>
      <p>© 2026 All Rights Reserved. 基于 SteveDarnell 与社区开源逻辑优化</p>
    </footer>
  </div>

  <script>
    // 切换模式
    function switchMode(mode) {
      if (mode === 'm3u2txt') {
        document.getElementById('m3u2txt-section').style.display = 'block';
        document.getElementById('txt2m3u-section').style.display = 'none';
        document.getElementById('modeM3UtoTXT').classList.add('active');
        document.getElementById('modeTXTtoM3U').classList.remove('active');
      } else {
        document.getElementById('m3u2txt-section').style.display = 'none';
        document.getElementById('txt2m3u-section').style.display = 'block';
        document.getElementById('modeM3UtoTXT').classList.remove('active');
        document.getElementById('modeTXTtoM3U').classList.add('active');
      }
    }

    // 清屏通用
    function clearAll() {
      document.getElementById('m3u-input').value = '';
      document.getElementById('txt-output').value = '';
      document.getElementById('txt-input').value = '';
      document.getElementById('m3u-output').value = '';
    }

    // ====================== M3U → TXT ======================
    function convertM3UtoTXT() {
      const input = document.getElementById('m3u-input').value.trim();
      if (!input) {
        alert('请输入M3U内容');
        return;
      }

      const lines = input.split('\n');
      let result = [];
      let currentGroup = null;

      for (let i = 0; i < lines.length; i++) {
        let line = lines[i].trim();

        if (line.startsWith('#EXTM3U')) continue;

        if (line.startsWith('#EXTINF:')) {
          let group = '未分组';
          const groupMatch = line.match(/group-title="([^"]*)"/);
          if (groupMatch && groupMatch[1].trim() !== '') {
            group = groupMatch[1].trim();
          }

          if (currentGroup !== group) {
            currentGroup = group;
            result.push(currentGroup + ',#genre#');
          }

          const parts = line.split(',');
          const name = parts[parts.length - 1].trim();

          let url = '';
          for (let j = i + 1; j < lines.length; j++) {
            let nextLine = lines[j].trim();
            if (nextLine && !nextLine.startsWith('#')) {
              url = nextLine;
              i = j;
              break;
            }
          }

          if (name && url) {
            result.push(name + ',' + url);
          }
        }
      }

      document.getElementById('txt-output').value = result.join('\n');
    }

    function copyTXT() {
      const output = document.getElementById('txt-output');
      if (!output.value) { alert('没有可拷贝的内容'); return; }
      output.select();
      document.execCommand('copy');
      alert('TXT结果已拷贝到剪贴板！');
    }

    function saveAsTXT() {
      const content = document.getElementById('txt-output').value;
      if (!content) { alert('没有可保存的内容'); return; }
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'playlist.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    // ====================== TXT → M3U ======================
    function convertTXTtoM3U() {
      const txtInput = document.getElementById('txt-input').value;
      if (!txtInput.trim()) {
        alert('请输入TXT内容');
        return;
      }

      const lines = txtInput.split('\n');
      let m3uOutput = '#EXTM3U x-tvg-url="https://live.fanmingming.com/e.xml"\n';
      let currentGroup = null;

      for (const line of lines) {
        const trimmedLine = line.trim();
        if (trimmedLine === '') continue;

        if (trimmedLine.includes('#genre#')) {
          currentGroup = trimmedLine.replace(/,#genre#/, '').trim();
        } else {
          const [originalChannelName, channelLink] = trimmedLine.split(',').map(item => item.trim());
          if (!channelLink) continue;

          const processedChannelName = originalChannelName.replace(/(CCTV|CETV)-(\d+).*/, '$1$2');

          m3uOutput += `#EXTINF:-1 tvg-name="${processedChannelName}" tvg-logo="https://live.fanmingming.com/tv/${processedChannelName}.png"`;
          if (currentGroup) {
            m3uOutput += ` group-title="${currentGroup}"`;
          }
          m3uOutput += `,${originalChannelName}\n${channelLink}\n`;
        }
      }

      document.getElementById('m3u-output').value = m3uOutput;
    }

    function copyM3U() {
      const output = document.getElementById('m3u-output');
      if (!output.value) { alert('没有可拷贝的内容'); return; }
      output.select();
      document.execCommand('copy');
      alert('M3U结果已拷贝到剪贴板！');
    }

    function saveAsM3U() {
      const content = document.getElementById('m3u-output').value;
      if (!content) { alert('没有可保存的内容'); return; }
      const blob = new Blob([content], { type: 'audio/x-mpegurl;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'playlist.m3u';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
